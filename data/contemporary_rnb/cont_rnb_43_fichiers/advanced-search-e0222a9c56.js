!function(l){l.widget("allmusic.listFilter",{options:{bindLabel:!1},_create:function(){this.element;this._setupExpandableOptions(),this._setupTextFilter()},_setupExpandableOptions:function(){var r=this.element,e=".options .expand-collapse";this.options.bindLabel&&(e+=", .options li:not([data-parent]) label"),r.find(e).click(function(){var e=l(this),t=e.data("id"),a=r.find('[data-parent="'+t+'"]');if(e.is("label")&&(t=(e=e.next()).data("id"),a=r.find('[data-parent="'+t+'"]')),e.is(".expanded"))e.removeClass("expanded").text("[+]"),a.hide();else{e.addClass("expanded").text("[-]"),a.show();var i=e.parent().offset().top-e.parent().parent().offset().top-e.parent().parent().scrollTop();e.closest(".options").scrollTop(i)}})},_setupTextFilter:function(){var i,r=this,n=r.element,s=n.find(".text-filter :text");s.after('<a class="clear">x</a>'),(i=s.next(".clear").hide()).click(function(e){e.preventDefault(),l(this).hide().prev(":text").val(""),r._resetTextFilter()}),s.keyup(function(){var e=s.val(),t=n.find(".options"),a=t.find("li");0<e.length?(i.show(),a.detach(),a.hide().filter('[data-text-filter*="'+e.toLowerCase()+'"]').show(),a.appendTo(t)):r._resetTextFilter()})},_resetTextFilter:function(){var e=this.element,t=e.find(".options"),a=t.find("li");e.find(".text-filter .clear").hide(),a.detach(),a.show(),a.filter("li[data-parent]").hide(),a.find(".expand-collapse").removeClass("expanded").text("[+]"),a.appendTo(t)}})}(jQuery),function(l){l.widget("allmusic.pullDown",{options:{selectors:{resize:".options"},styles:{self:{position:"absolute",bottom:"0px",width:"94%",margin:"0 3%","border-top":"1px solid #e3e3e3","background-image":'url("'+cdnURL+'/images/advanced_search/bars.png")',"background-position":"50% 50%","background-repeat":"no-repeat",cursor:"pointer"},parent:{position:"relative"},resize:{height:"200px","min-height":"200px"}}},_create:function(){},_init:function(){var t=this.options.selectors.resize;this.element.css(this.options.styles.self),this.element.parent().css(this.options.styles.parent),this.element.parent().find(t).css(this.options.styles.resize),this.element.addClass("hand-cursor"),this.element.unbind(".pullDown"),this.element.on("mousedown.pullDown",function(e){e.originalEvent.preventDefault();var i=l(this),r=i.parent().find(t),n=r.height(),s=e.pageY;l("body").toggleClass("hand-cursor-closed"),i.toggleClass("hand-cursor-closed"),l(document).on("mouseup.pullDown",function(){l(document).unbind(".pullDown"),l("body").toggleClass("hand-cursor-closed"),i.toggleClass("hand-cursor-closed")}),l(document).on("mousemove.pullDown",function(e){var t=e.pageY-s,a=0;i.prev().find(">*").each(function(){a+=l(this).height()}),r.css({"max-height":a,height:n+t})})})}}),l(".pull-down").pullDown()}(jQuery),$(function(){var l,s="",x="",d=["genres","moods","themes","artists0","artists1","artists2","artists3"],e=$({});$.subscribe=function(){e.on.apply(e,arguments)},$.unsubscribe=function(){e.off.apply(e,arguments)},$.publish=function(){e.trigger.apply(e,arguments)},$(".filter header").click(function(){var e=$(this);if(e.toggleClass("collapsed"),e.is(".collapsed"))e.children(".arrow").html("&darr;"),e.parent().data("orig-height",e.parent().height()),e.parent().animate({height:e.height()},"fast",function(e){$(this).css("overflow","hidden")});else{e.children(".arrow").html("&uarr;");var t=e.parent().data("orig-height")+"px";e.parent().animate({height:t},"fast",function(e){$(this).css("overflow",""),$(this).css("height","")})}}),$(".filter.genres").listFilter(),$(".filter.themes, .filter.moods").listFilter({bindLabel:!0}),$(".filter :checkbox").on({change:function(){var e=$(this);e.is(":checked")?e.attr("data-filter-id",this.id):e.removeAttr("data-filter-id"),$.publish("update.advancedSearch")},removeFilter:function(){$(this).removeAttr("checked data-filter-id")}}),$(".filter :radio").on({change:function(){var e=$(this);e.closest(".filter").find(":radio").removeAttr("data-filter-id"),e.is(":checked")&&e.attr("data-filter-id",this.id),$.publish("update.advancedSearch")},removeFilter:function(){$(this).closest(".filter").find(":radio").removeAttr("data-filter-id checked").filter("#all-recording-types").prop("checked",!0)}}),$(".filter select").on({change:function(){var e,t=$(this);t.val().length?(e=t.is('[name="start-year"]')?"releaseyear>:"+t.val():"releaseyear<:"+t.val(),t.attr("data-filter-id",e)):t.removeAttr("data-filter-id");$.publish("update.advancedSearch")},removeFilter:function(){$(this).val("").removeAttr("data-filter-id").trigger("change")}}),$(".filter.years select").change(function(){var e=$(this),t=$('[name="start-year"]'),a=$('[name="end-year"]'),i=(this.value,(new Date).getFullYear()),r=t.val()?t.val():1920,n=a.val()?a.val():i;if(e.is(t))for(var s=i;1920<=s;s--)$yearOption=a.find(":contains("+s+")"),r<=s&&0===$yearOption.length?a.append('<option value="'+s+'">'+s+"</option>"):s<r&&$yearOption.length&&$yearOption.remove();else if(e.is(a))for(s=1920;s<=i;s++)$yearOption=t.find(":contains("+s+")"),s<=n&&0===$yearOption.length?t.find("option:first").after('<option value="'+s+'">'+s+"</option>"):n<s&&$yearOption.length&&$yearOption.remove()}),$(".filter.artists :text").typeahead({appendTo:".filter.artists",itemSelector:"li",minLength:2,seeAllLink:!1,url:"/search/typeahead/artist",select:function(e){this.val(e.text).attr({"data-filter-id":"performerid:"+e.id,disabled:"disabled"}),this.siblings(".clear").fadeIn("fast").css("display","inline-block"),$.publish("update.advancedSearch"),this.parent().next("p").show().find(":text").focus()}}).blur(function(){var e=$(this);void 0===e.attr("data-filter-id")&&e.val("").siblings(".clear").fadeOut("fast")}).on("removeFilter",function(){$(this).siblings(".clear").click()}),$(".filter.artists .clear").click(function(){var e=$(this);e.fadeOut("fast").siblings(":text").removeAttr("disabled data-filter-id").val(""),$.publish("update.advancedSearch");var t=e.parent().detach();$(".filter.artists :text[data-filter-id]").length<3&&t.hide(),$(".filter.artists .options").append(t)}),$(".active-filters .query").on("click","a",function(e){e.preventDefault();var t=$(this).data("filter-id");$('.filter [data-filter-id="'+t+'"]').trigger("removeFilter"),$.publish("update.advancedSearch")}),$(".clear-all-filters").click(function(e){e.preventDefault(),$(".filter [data-filter-id]").trigger("removeFilter"),$.publish("update.advancedSearch")}),$(".active-filters .and-logic").click(function(e){e.preventDefault(),x="and",Cookie.create("advancedSearchLogic",x,365),$.publish("update.advancedSearch")}),$(".active-filters .or-logic").click(function(e){e.preventDefault(),x="or",Cookie.create("advancedSearchLogic",x,365),$.publish("update.advancedSearch")});var t=function(){l={genres:[],startYear:{},endYear:{},ratings:[],recordingType:{},moods:[],themes:[],artist0:{},artist1:{},artist2:{},artist3:{}};var e=[],t=[],a=[],i=[];$('.filter [name="genre"]:checked').each(function(){l.genres.push({id:$(this).data("filter-id"),label:this.value}),this.id&&e.push(this.id)}),$('.filter [name="theme"]:checked').each(function(){l.themes.push({id:$(this).data("filter-id"),label:this.value}),t.push(this.id)}),$('.filter [name="mood"]:checked').each(function(){l.moods.push({id:$(this).data("filter-id"),label:this.value}),a.push(this.id)}),$(".filter.ratings :checked").each(function(){l.ratings.push({id:$(this).data("filter-id"),label:this.value}),i.push(this.id)});var r=$('.filter [name="start-year"]').val(),n=$('.filter [name="end-year"]').val();r.length&&(l.startYear={id:"releaseyear>:"+r,label:r}),n.length&&(l.endYear={id:"releaseyear<:"+n,label:n}),$recordingType=$(".filter.types :checked"),"all"!=$recordingType.val()&&(l.recordingType={id:$recordingType.data("filter-id"),label:$recordingType.val()}),$(".filter.artists [data-filter-id]").each(function(e){l["artists"+e]={id:$(this).data("filter-id"),label:this.value}}),"sessionStorage"in window&&(sessionStorage.genreStore=e,sessionStorage.themeStore=t,sessionStorage.moodStore=a,sessionStorage.ratingStore=i,sessionStorage.startYearStore=r,sessionStorage.endYearStore=n,sessionStorage.recordingTypeStore=l.recordingType.id?l.recordingType.id:"")};$.manageAjax.create("allmusic.advancedSearch",{cacheResponse:!0,queue:!1});var r=function(e){var t={filters:[],sort:s},a=[];for(var i in l)if(l[i]instanceof Array&&l[i].length&&(-1<d.indexOf(i)&&"or"==x||-1==d.indexOf(i))){var r=[];for(var n in l[i])void 0!==l[i][n].id&&r.push(l[i][n].id);t.filters.push(r.join("|"))}else if(l[i]instanceof Array&&l[i].length&&-1<d.indexOf(i)&&"and"==x){r=[];for(var n in l[i])void 0!==l[i][n].id&&r.push(l[i][n].id);t.filters.push(r.join("&"))}else l[i]instanceof Object&&"id"in l[i]&&-1<d.indexOf(i)&&"or"==x?void 0!==l[i].id&&a.push(l[i].id):l[i]instanceof Object&&"id"in l[i]&&void 0!==l[i].id&&t.filters.push(l[i].id);if(0<a.length){r=[];for(var n in a)r.push(a[n]);t.filters.push(r.join("|"))}e=e||"",$.manageAjax.add("allmusic.advancedSearch",{abort:!0,queue:"clear",url:"/advanced-search/results/"+e,data:t,dataType:"html",type:"POST",beforeSend:function(){$(".results").html('<span class="loading">')},success:function(e){var t=$(".results");t.html(e),t.find("img.lazy:hidden").show().lazyload({effect:"fadeIn",failure_limit:100,threshold:200}),$(window).scroll()}})};$.subscribe("update.advancedSearch",function(e){t(),function(){var e=[],t=[];for(var a in"id"in l.startYear&&"id"in l.endYear?e.push('( <a href="#" data-filter-id="'+l.startYear.id+'">'+l.startYear.label+'</a> - <a href="#" data-filter-id="'+l.endYear.id+'">'+l.endYear.label+"</a> )"):"id"in l.startYear?e.push('<a href="#" data-filter-id="'+l.startYear.id+'">'+l.startYear.label+" &amp; after</a>"):"id"in l.endYear&&e.push('<a href="#" data-filter-id="'+l.endYear.id+'">'+l.endYear.label+" &amp; before</a>"),l)if("startYear"!=a&&"endYear"!=a){var i="";if(l[a]instanceof Array&&l[a].length){var r=[];for(var n in l[a]){var s=l[a][n];void 0!==s.label&&r.push('<a href="#" data-filter-id="'+s.id+'">'+s.label+"</a>")}i="and"==x&&-1<d.indexOf(a)?r.join(" and "):r.join(" or "),1<l[a].length&&(i="( "+i+" )"),e.push(i)}else l[a]instanceof Object&&"id"in l[a]&&-1<d.indexOf(a)?t.push('<a href="#" data-filter-id="'+l[a].id+'">'+l[a].label+"</a>"):l[a]instanceof Object&&"id"in l[a]&&e.push('<a href="#" data-filter-id="'+l[a].id+'">'+l[a].label+"</a>")}0<t.length&&(i="and"==x?t.join(" and "):t.join(" or "),e.push("( "+i+" )")),$(".active-filters .query").html(e.join(" <em>and</em> ")),"block"!==$(".active-filters").css("display")&&$(".active-filters").fadeIn("fast"),e.length<=0&&$(".active-filters .query").html("No filters selected")}(),r()}),$.subscribe("initialLoad.advancedSearch",function(e){t()}),$(document).on("click",".pagination a",function(e){e.preventDefault(),window.scrollTo($(window).scrollLeft(),0);var t=/\d+$/.exec($(this).attr("href"));t=null!==t&&t.length?t[0]:0,r(t)}),$(".results").on("click","th.sortable a",function(e){e.preventDefault();var t,a,i=$(this).closest(".sortable");i.is(".year")?t="releaseyear":i.is(".title")?t="name":i.is(".rating")&&(t="editorialrating"),a=i.is(".asc")?"desc":i.is(".desc")?"asc":i.data("sort-default"),i.removeClass("asc desc").addClass(a),s=t+","+a,r()}),$(document).ready(function(){if("sessionStorage"in window){var e=sessionStorage.genreStore,t=sessionStorage.startYearStore,a=sessionStorage.endYearStore,r=sessionStorage.ratingStore,n=sessionStorage.recordingTypeStore,s=sessionStorage.moodStore,l=sessionStorage.themeStore;if(e){var d=e.split(","),o=d.length;for(i=0;i<o;i++){var c=d[i];c=(c=c.replace("styleid","subgenreid")).replace(":","\\:"),$("#"+c).attr("checked",!0).attr("data-filter-id",c.replace("\\",""))}}if(t&&$("select.start-year").find('option[value="'+t+'"]').attr("selected",!0).attr("data-filter-id",t),a&&$("select.end-year").find('option[value="'+a+'"]').attr("selected",!0).attr("data-filter-id",a),r){var h=r.split(","),f=h.length;for(i=0;i<f;i++){var p=h[i];p=p.replace(":","\\:"),$("#"+p).attr("checked",!0).attr("data-filter-id",p.replace("\\",""))}}if(n&&null!=n?(n=n.replace(":","\\:"),$("#"+n).attr("checked",!0).attr("data-filter-id",n.replace("\\",""))):$("#all-recording-types").attr("checked",!0).attr("data-filter-id","all-recording-types"),s){var u=s.split(","),v=u.length;for(i=0;i<v;i++){var g=u[i];g=g.replace(":","\\:"),$("#"+g).attr("checked",!0).attr("data-filter-id",g.replace("\\",""))}}if(l){var m=l.split(","),b=m.length;for(i=0;i<b;i++){var y=m[i];y=y.replace(":","\\:"),$("#"+y).attr("checked",!0).attr("data-filter-id",y.replace("\\",""))}}null==(x=Cookie.read("advancedSearchLogic"))&&(x="or"),e||t||a||r||n||s||l?$.publish("update.advancedSearch"):$.publish("initialLoad.advancedSearch")}})}),$(function(){enquire.register("screen and (max-width: "+mobileMaxWidth+"px)",{match:function(){$(".filter header").addClass("collapsed").children(".arrow").html("&darr;"),$(".filter").css("height","42px").css("overflow","hidden"),$(".content").insertAfter("filter.artists"),$(".sidebar .advertising.medium-rectangle").insertAfter(".content"),$(".filter header").click(function(){var e=$(this);if(e.toggleClass("collapsed"),e.is(".collapsed")){e.children(".arrow").html("&uarr;"),e.removeClass("collapsed");var t=e.parent().data("orig-height")+"px";e.parent().animate({height:t},"fast",function(e){$(this).css("overflow",""),$(this).css("height","")})}else e.children(".arrow").html("&darr;"),e.addClass("collapsed"),e.parent().data("orig-height",e.parent().height()),e.parent().animate({height:e.height()},"fast",function(e){$(this).css("overflow","hidden")});window.scrollTo(0,e.offset().top)})},unmatch:function(){$(".filter header").removeClass("collapsed"),$(".advertising.medium-rectangle").appendTo(".sidebar"),$(".content").insertAfter(".sidebar"),$(".tabs .tab").unbind(".mobile")}}).listen(500)});